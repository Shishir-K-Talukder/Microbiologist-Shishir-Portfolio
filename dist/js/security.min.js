class e{constructor(e=5,t=36e5){this.maxRequests=e,this.timeWindow=t,this.requests=new Map}isRateLimited(e){let t=Date.now(),s=(this.requests.get(e)||[]).filter(e=>t-e<this.timeWindow);return s.length>=this.maxRequests||(s.push(t),this.requests.set(e,s),!1)}}function a(){var e=new Uint8Array(32);return crypto.getRandomValues(e),Array.from(e,e=>e.toString(16).padStart(2,"0")).join("")}document.addEventListener("DOMContentLoaded",function(){let r=new e;document.querySelectorAll("form").forEach(e=>{var t=a(),s=document.createElement("input");s.type="hidden",s.name="csrf_token",s.value=t,e.appendChild(s),sessionStorage.setItem("csrf_token",t)}),document.querySelectorAll("form").forEach(e=>{e.addEventListener("submit",async function(e){e.preventDefault();e=localStorage.getItem("clientId")||crypto.randomUUID();if(localStorage.setItem("clientId",e),r.isRateLimited(e))alert("Too many requests. Please try again later.");else{e=this.querySelector('[name="csrf_token"]').value;if(e!==sessionStorage.getItem("csrf_token"))alert("Security validation failed. Please refresh the page.");else try{var t=new FormData(this),s=await fetch(this.action,{method:"POST",body:t,headers:{"X-CSRF-Token":e}});if(!s.ok)throw new Error("Network response was not ok");if((await s.json()).success){let e=document.getElementById("success-popup");e&&(e.classList.add("show"),setTimeout(()=>e.classList.remove("show"),3e3)),this.reset()}}catch(e){alert("An error occurred. Please try again.")}}})})});